---
import type { MatchData } from "../types/agenda";
import { Image } from "astro:assets";

interface Props {
    match: MatchData;
    variant?: "default" | "plain";
}

// Desestructuración de las props tipadas
const { match, variant = "default" } = Astro.props;

// Importar logos dinámicamente
const logos = import.meta.glob<{ default: ImageMetadata }>(
    "../assets/logos/*.{png,webp,svg,jpg}",
    { eager: true },
);

function getLogo(logoName: string | null | undefined) {
    if (!logoName) return null;
    const path = `../assets/logos/${logoName}`;
    const logo = logos[path];
    return logo ? logo.default : null;
}

const victorianosLogo = getLogo(match.logo_victorianos);
const rivalLogo = getLogo(match.logo_rival);

const victorianosData = {
    name: "Victorianos",
    logo: victorianosLogo,
};

// 2. Datos del Rival
const rivalData = {
    name: match.rival,
    logo: rivalLogo,
};

// 1. Obtener la cadena de fecha ISO (ej: "2025-11-16")
const isoDate = match.fecha;

// 2. Partir la cadena en sus componentes [AAAA, MM, DD]
// El método split('-') la divide por el guion.
const [year, month, day] = isoDate.split("-");

// 3. Reensamblar en el formato DD-MM-AAAA
const formattedDate = `${day}-${month}-${year}`;

// 3. Asignación de Roles (Local vs. Visitante)
const localTeam = match.esLocal ? victorianosData : rivalData;
const awayTeam = match.esLocal ? rivalData : victorianosData;

// Información adicional
const ubicacion = match.ubicacion;
const hora = match.hora;
const tipoPartido = match.tipo;
---

<div
    class={variant === "default"
        ? "w-full max-w-xl mx-auto p-4 md:p-6 bg-white border border-gray-200 rounded-xl shadow-xl hover:shadow-2xl transition duration-300 transform hover:scale-[1.01] "
        : "w-full max-w-xl mx-auto p-6 md:p-6"}
>
    <div
        class={variant === "default"
            ? "flex items-center justify-between w-full "
            : "flex items-center justify-between w-full pb-8"}
    >
        <div class="flex flex-col items-center w-1/4 text-center">
            {
                localTeam.logo && (
                    <Image
                        src={localTeam.logo}
                        alt={localTeam.name}
                        width={100}
                        height={100}
                        class="h-16 md:h-24 w-16 md:w-24 object-contain"
                    />
                )
            }
            <p class="mt-2 text-sm font-semibold text-club-blue font-headline">
                {localTeam.name}
            </p>
            <span class="text-xs text-gray-500 mt-1">Local</span>
        </div>

        <div class="flex flex-col items-center w-3/4 text-center px-2">
            <p
                class="text-xs uppercase font-bold text-club-yellow bg-club-blue px-2 py-0.5 rounded-full mb-3 shadow-md"
            >
                {tipoPartido}
            </p>

            {
                match.resultado ? (
                    // Si hay resultado: Muestra el marcador final
                    <div class="text-4xl font-headline font-extrabold text-gray-800">
                        {match.esLocal
                            ? match.resultado.victorianos
                            : match.resultado.rival}{" "}
                        -{" "}
                        {match.esLocal
                            ? match.resultado.rival
                            : match.resultado.victorianos}
                    </div>
                ) : (
                    // Si no hay resultado: Muestra la hora
                    <div class="text-3xl font-headline font-bold text-gray-800">
                        {hora}
                    </div>
                )
            }

            <p class="text-sm mt-3 text-gray-600 font-body">{formattedDate}</p>
            <p class="text-xs text-gray-500 font-body">{ubicacion}</p>
        </div>

        <div class="flex flex-col items-center w-1/4 text-center">
            {
                awayTeam.logo && (
                    <Image
                        src={awayTeam.logo}
                        alt={awayTeam.name}
                        width={100}
                        height={100}
                        class="h-16 md:h-24 w-16 md:w-24 object-contain"
                    />
                )
            }
            <p class="mt-2 text-sm font-semibold text-gray-800 font-headline">
                {awayTeam.name}
            </p>
            <span class="text-xs text-gray-500 mt-1">Visitante</span>
        </div>
    </div>

    {
        match.resultado && match.link_youtube && (
            <div class="mt-4 pt-4 border-t border-gray-100 text-center">
                <a
                    href={match.link_youtube}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="text-sm font-semibold text-red-600 hover:text-red-700 transition flex items-center justify-center"
                >
                    Ver Partido Completo
                </a>
            </div>
        )
    }
</div>
